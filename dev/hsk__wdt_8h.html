<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>hsk-libs-dev: hsk_wdt/hsk_wdt.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">hsk-libs-dev
   &#160;<span id="projectnumber">270</span>
   </div>
   <div id="projectbrief">High Speed Karlsruhe XC878 library collection</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_1cc859bf3115777c1b0d9f76393bbccc.html">hsk_wdt</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">hsk_wdt.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>HSK Watchdog Timer headers.  
<a href="#details">More...</a></p>
<div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="hsk__wdt_8h__dep__incl.svg" width="231" height="112"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
</div>
<p><a href="hsk__wdt_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a354e2c3989af35f9c2a059d3f0beba86"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hsk__wdt_8h.html#a354e2c3989af35f9c2a059d3f0beba86">hsk_wdt_init</a> (const uword window)</td></tr>
<tr class="memdesc:a354e2c3989af35f9c2a059d3f0beba86"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets up the watchdog timer.  <a href="#a354e2c3989af35f9c2a059d3f0beba86">More...</a><br /></td></tr>
<tr class="separator:a354e2c3989af35f9c2a059d3f0beba86"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adc711831b93a22ece59252549f9d8ea9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hsk__wdt_8h.html#adc711831b93a22ece59252549f9d8ea9">hsk_wdt_enable</a> (void)</td></tr>
<tr class="memdesc:adc711831b93a22ece59252549f9d8ea9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Activates the Watchdog Timer.  <a href="#adc711831b93a22ece59252549f9d8ea9">More...</a><br /></td></tr>
<tr class="separator:adc711831b93a22ece59252549f9d8ea9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3f46c324373fec956095ad84ad5f7381"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hsk__wdt_8h.html#a3f46c324373fec956095ad84ad5f7381">hsk_wdt_disable</a> (void)</td></tr>
<tr class="memdesc:a3f46c324373fec956095ad84ad5f7381"><td class="mdescLeft">&#160;</td><td class="mdescRight">Disables the Watchdog Timer.  <a href="#a3f46c324373fec956095ad84ad5f7381">More...</a><br /></td></tr>
<tr class="separator:a3f46c324373fec956095ad84ad5f7381"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a647944508e2a8f6ed9a3aee9e350b32d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hsk__wdt_8h.html#a647944508e2a8f6ed9a3aee9e350b32d">hsk_wdt_service</a> (void)</td></tr>
<tr class="memdesc:a647944508e2a8f6ed9a3aee9e350b32d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Resets the watchdog timer.  <a href="#a647944508e2a8f6ed9a3aee9e350b32d">More...</a><br /></td></tr>
<tr class="separator:a647944508e2a8f6ed9a3aee9e350b32d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>HSK Watchdog Timer headers. </p>
<p>Provides access to the Watchdog Timer (WDT) of the XC878.</p>
<p>Depending on the configured window time the µC reset is delayed for 1.024ms (window &lt; 5460µs) or 65.536ms (window &gt;= 5460µs).</p>
<p>This time can be used by assigning a callback function to <a class="el" href="hsk__isr_8h.html#aca30b0c86a1a7242d33de0e376857e55">hsk_isr14</a> member <a class="el" href="structhsk__isr14__callback.html#a07c34d8674c435100b8634029f60165e">hsk_isr14_callback::NMIWDT</a> and setting the NMICON.NMIWDT bit.</p>
<dl class="section warning"><dt>Warning</dt><dd>The WDT should be set up at the end of the boot procedure. Setting the WDT up at the beginning of the boot process can trigger all kinds of erratic behaviour like reset races or a complete lockup. </dd></dl>
<dl class="section author"><dt>Author</dt><dd>kami</dd></dl>
<h1><a class="anchor" id="hazards"></a>
Hazards</h1>
<p>The WDT has proven a useful tool in hazardous EMI conditions. Severe EMI may freeze the µC without causing a proper reboot. In most cases the WDT can mitigate this issue by reactivating the system.</p>
<p>However the WDT is trigger happy. A series of refresh time interval measurements shows that the WDT resets the µC long before the end of its interval shortly after boot. The best mitigation is to refresh the WDT with the <a class="el" href="hsk__wdt_8h.html#a647944508e2a8f6ed9a3aee9e350b32d" title="Resets the watchdog timer. ">hsk_wdt_service()</a> function unconditionally. Instead of using fixed timings (e.g. for 20ms watchdog time a 5ms refresh interval should have been quite safe).</p>
<p>That however does not solve the problem with NMIs. Any non-maskable interrupt may cause the WDT to reset the µC. This means it is incopatible to the hsk_flash library, which requires precise timings with only a couple of µs tolerance. To meet this requirement the library uses the Flash Timer of the XC878, which triggers NMIs. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a3f46c324373fec956095ad84ad5f7381"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3f46c324373fec956095ad84ad5f7381">&sect;&nbsp;</a></span>hsk_wdt_disable()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void hsk_wdt_disable </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Disables the Watchdog Timer. </p>

</div>
</div>
<a id="adc711831b93a22ece59252549f9d8ea9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adc711831b93a22ece59252549f9d8ea9">&sect;&nbsp;</a></span>hsk_wdt_enable()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void hsk_wdt_enable </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Activates the Watchdog Timer. </p>

</div>
</div>
<a id="a354e2c3989af35f9c2a059d3f0beba86"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a354e2c3989af35f9c2a059d3f0beba86">&sect;&nbsp;</a></span>hsk_wdt_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void hsk_wdt_init </td>
          <td>(</td>
          <td class="paramtype">const uword&#160;</td>
          <td class="paramname"><em>window</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets up the watchdog timer. </p>
<p>The window time specifies the time available to call <a class="el" href="hsk__wdt_8h.html#a647944508e2a8f6ed9a3aee9e350b32d" title="Resets the watchdog timer. ">hsk_wdt_service()</a> before a reset is triggered. Possible times range from 21.3µs to 350ms.</p>
<p>The window time is rounded up to the next higher possible value. Exceeding the value range causes an overflow that results in shorter window times.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">window</td><td>The time window in multiples of 10µs </td></tr>
  </table>
  </dd>
</dl>
<p>The WDT runs at PCLK/2 or PCLK/128, i.e. the WDT low byte WDTL overlow occurs either every 21.333µs or every 1365.333ms.</p>
<p>One time unit (10µs) equals 120 PCLK/2 clock ticks. One PCLK/128 time unit (640µs) equals 120 PCLK/128 clock ticks.</p>

</div>
</div>
<a id="a647944508e2a8f6ed9a3aee9e350b32d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a647944508e2a8f6ed9a3aee9e350b32d">&sect;&nbsp;</a></span>hsk_wdt_service()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void hsk_wdt_service </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Resets the watchdog timer. </p>
<p>This function needs to be called to prevent the WDT from resetting the device. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Jan 20 2017 00:01:51 for hsk-libs-dev by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.12
</small></address>
</body>
</html>
