<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>hsk-libs-dev: The Project Makefile</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">hsk-libs-dev
   &#160;<span id="projectnumber">270</span>
   </div>
   <div id="projectbrief">High Speed Karlsruhe XC878 library collection</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">The Project Makefile </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The project Makefile offers access to all the UNIX command line facilities of the project. The file is written for the FreeBSD make, which is a descendant of PMake. Some convenience and elegance was sacrificed to make the Makefile GNU Make compatible.</p>
<h1><a class="anchor" id="make_doxygen"></a>
Generating the Documentation</h1>
<p>The Makefile can invoke Doxygen with the <code>make</code> targets <code>html</code> and <code>pdf:</code> </p><pre class="fragment"># make html pdf
Searching for include files...
Searching for example files...
Searching for images...
[...]
</pre><p>The <code>html</code> target creates the directories html/user/ and html/dev/, which contain the HTML version of this documentation.</p>
<p>The <code>pdf</code> target creates the directory pdf/ with the PDF versions of this documentation.</p>
<p>The targets create a Users' and a Developers' Manual. The first only includes documentation for public interfaces (i.e. headers). The second also includes the documentation of the implementation and some additional tidbits in this chapter that are only of interest when developing the libraries instead of building applications with them.</p>
<h2><a class="anchor" id="make_doxygen_dependencies"></a>
Dependencies</h2>
<p>In order to build the documentation the following tools need to be installed on the system:</p><ul>
<li>Doxygen</li>
<li>GraphViz (for creating dependency graphs)</li>
<li>teTeX (for pdflatex)</li>
</ul>
<h1><a class="anchor" id="make_build"></a>
Building</h1>
<p>The Makefile uses SDCC to build. This can be changed in the first lines of the Makefile. The default target <code>build</code> builds all the .c files. Each .c file containing a <a class="el" href="main_8c.html#a6288eba0f8e8ad3ab1544ad731eb7667" title="Call init functions and invoke the run routine. ">main()</a> function will also be linked, resulting in a .hex file: </p><pre class="fragment"># make
sdcc -mmcs51 [...] -o bin.sdcc/hsk_adc/hsk_adc.rel -c src/hsk_adc/hsk_adc.c
sdcc -mmcs51 [...] -o bin.sdcc/hsk_boot/hsk_boot.rel -c src/hsk_boot/hsk_boot.c
sdcc -mmcs51 [...] -o bin.sdcc/hsk_can/hsk_can.rel -c src/hsk_can/hsk_can.c
sdcc -mmcs51 [...] -o bin.sdcc/hsk_wdt/hsk_wdt.rel -c src/hsk_wdt/hsk_wdt.c
sdcc -mmcs51 [...] -o bin.sdcc/hsk_icm7228/hsk_icm7228.rel -c src/hsk_icm7228/hsk_icm7228.c
sdcc -mmcs51 [...] -o bin.sdcc/hsk_isr/hsk_isr.rel -c src/hsk_isr/hsk_isr.c
sdcc -mmcs51 [...] -o bin.sdcc/hsk_pwc/hsk_pwc.rel -c src/hsk_pwc/hsk_pwc.c
sdcc -mmcs51 [...] -o bin.sdcc/hsk_pwm/hsk_pwm.rel -c src/hsk_pwm/hsk_pwm.c
sdcc -mmcs51 [...] -o bin.sdcc/hsk_timers/hsk_timer01.rel -c src/hsk_timers/hsk_timer01.c
sdcc -mmcs51 [...] -o bin.sdcc/hsk_flash/hsk_flash.rel -c src/hsk_flash/hsk_flash.c
sdcc -mmcs51 [...] -o bin.sdcc/main.rel -c src/main.c
sdcc -mmcs51 [...] -o bin.sdcc/main.hex bin.sdcc/hsk_timers/hsk_timer01.rel [...]
</pre><p>All compiler output is dumped into the bin.sdcc/ directory. All the .c files are built, independent of whether they are linked into a .hex file.</p>
<h1><a class="anchor" id="make_details"></a>
Implementation Details</h1>
<p>The Makefile consits of three parts:</p><ul>
<li>Building</li>
<li>Documentation building</li>
<li>Cleaning</li>
</ul>
<h2><a class="anchor" id="make_details_building"></a>
Building</h2>
<p>The Makefile declares the target <code>build</code> first to make it the default target. None of the build targets are manually defined. Instead with every invocation of <code>make</code> the script <code>scripts/build.sh</code> is invoked to regenerate the file build.mk.</p>
<p>The <code>build.sh</code> script searches the source directory for <code>.c</code> files and runs <code>scripts/depends.awk</code> in <code>-compile</code> mode to generate a dependency tree.</p>
<p>In the next stage <code>build.sh</code> generates the build instructions for each <code>.c</code> file.</p>
<p>The last step is to create the linking instructions. For that the script searches for <code>.c</code> files that appear to contain a <a class="el" href="main_8c.html#a6288eba0f8e8ad3ab1544ad731eb7667" title="Call init functions and invoke the run routine. ">main()</a> function. The <code>scripts/depends.awk</code> script in <code>-link</code> mode is used to determine all the libraries that have to be linked with each of the <a class="el" href="main_8c.html#a6288eba0f8e8ad3ab1544ad731eb7667" title="Call init functions and invoke the run routine. ">main()</a> containing <code>.c</code> files.</p>
<h2><a class="anchor" id="make_details_doxygen"></a>
Documentation</h2>
<p>The targets <code>doc</code> and <code>doc-private</code> build the user and the developer documentation. The <code>html</code> target simply copies them to the html/ directory.</p>
<p>The <code>pdf</code> target copies the PDF versions of the manuals to pdf/, but first a PDF needs to be generated by running <code>make</code> in the doc/latex/ and doc-private/latex/ directories, which is done by the respective targets.</p>
<h2><a class="anchor" id="make_details_clean"></a>
Clean</h2>
<p>The <code>clean-doc</code> target removes the directory doc/, the <code>clean-doc-private</code> target removes the directory doc-private/ and the target <code>clean-build</code> removes the directory <code>BUILDDIR</code>, which defaults to bin.sdcc/.</p>
<p>The meta-target <code>clean</code> invokes all these targets.</p>
<h1><a class="anchor" id="make_cygwin"></a>
Cygwin</h1>
<p>Using a combination of native Binaries and Cygwin, the complete set of build and generator facilities can be used from Microsoft Windows.</p>
<p>The followin downloads are required:</p><ul>
<li>GIT: <a href="https://git-scm.com/downloads">https://git-scm.com/downloads</a></li>
<li>SDCC: <a href="https://sourceforge.net/projects/sdcc/files/">https://sourceforge.net/projects/sdcc/files/</a></li>
<li>Cygwin installer: <a href="http://cygwin.com/install.html">http://cygwin.com/install.html</a></li>
</ul>
<p>Additionally to the defaults the following Cygwin packages have to be installed:</p><ul>
<li>Devel: gcc-core</li>
<li>Devel: libiconv</li>
<li>Devel: make</li>
</ul>
<p>After the installation the PATH variable should reference SDCC and Cygwin: </p><div class="image">
<img src="cygwin_PATH.png" alt="cygwin_PATH.png"/>
<div class="caption">
Cygwin and SDCC PATH environment</div></div>
<p>The libraries provide simple batch files to execute <code>uVisionupdate.sh</code> and call <code>make</code>. For ease of use the table of <code>make</code> targets is displayed: </p><div class="image">
<img src="cygwin_cygwin-make.png" alt="cygwin_cygwin-make.png"/>
<div class="caption">
Make and available targets in Cygwin</div></div>
 </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Jan 20 2017 00:01:51 for hsk-libs-dev by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.12
</small></address>
</body>
</html>
