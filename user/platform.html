<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>hsk-libs-user: The XC878 8-Bit Microcontroller Platform</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">hsk-libs-user
   &#160;<span id="projectnumber">270</span>
   </div>
   <div id="projectbrief">High Speed Karlsruhe XC878 library collection</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">The XC878 8-Bit Microcontroller Platform </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The XC878 is an Intel 8051/8052 compatible µC architecture. This entails strong memory limitations with severe implications to writing code.</p>
<p>The strength of the architecture is that the controller contains many specialized modules that, once set up, perform many tasks without intense interaction.</p>
<p>Critical for this project are the following kinds of modules:</p><ul>
<li>10-Bit AD conversion channels</li>
<li>Timers that can be triggered by external signals or perform PWM</li>
<li>CAN controller</li>
</ul>
<dl class="section see"><dt>See also</dt><dd>XC878 Reference Manual: <a href="../contrib/XC878_um_v1_1.pdf">XC878_um_v1_1.pdf</a> </dd>
<dd>
ARM Keil Infineon XC878-16FF page: <a href="http://www.keil.com/dd/chip/4480.htm">http://www.keil.com/dd/chip/4480.htm</a> </dd>
<dd>
Infineon XC87x Series Overview: <a href="http://www.infineon.com/cms/en/product/microcontrollers/8-bit/xc800-a-family-automotive/xc87x-series/channel.html?channel=db3a304323b87bc20123dcee653f7007&amp;tab=2">http://www.infineon.com/cms/en/product/microcontrollers/8-bit/xc800-a-family-automotive/xc87x-series/channel.html?channel=db3a304323b87bc20123dcee653f7007&amp;tab=2</a> </dd>
<dd>
8051 Basics Tutorial: <a href="http://www.8052.com/tut8051">http://www.8052.com/tut8051</a></dd></dl>
<h1><a class="anchor" id="platform_registers"></a>
Registers and Paging</h1>
<p>The XC878 functions and modules are controlled through so called Special Function Registers (SFRs).</p>
<p>Due to the number of modules and functions of the controller a lot more registers are present than the 128 that can be addressed. These 128 register addressed in the upper dirctly addressable address range from <code>0x80</code> to <code>0xFF.</code></p>
<p>To circumvent the 128 register limit each functional block of registers has a paging register that can be used to access different Pages of registers. In C code this is done using the SFR_PAGE() macro defined in the Infineon/XC878.h header file that is provided by Keil µVision, the IDE used for this project or the headers can directly be <a href="http://www.keil.com/dd/docs/c51/infineon/xc878.h">downloaded from ARM</a>.</p>
<p>Paging only affects code that directly interacts with the hardware. One of the benefits of <em>using</em> these libraries is that paging is not an issue in the logical code.</p>
<p>Each section of the <a href="../contrib/XC878_um_v1_1.pdf">XC878 Reference Manual</a> has a Register Overview that contains a table of pages and registers.</p>
<h1><a class="anchor" id="platform_memory"></a>
Memory Limitations</h1>
<p>The 8051 platform offers 128 bytes of <code>data</code> memory in the address range 0x00-0x7F in front of the SFR address range. Because 128 bytes are insufficient, the 8051 architecture knows several kinds of memory that are accessed in different manners and thus quicker or slower to access.</p>
<p>The 8052 has an additional 128 bytes of indirectly addressable memory. This memory is accessed through the key word <code>idata</code>. Access to <code>idata</code> is slower than to <code>data</code>. The syntax for declaring a variable in <code>idtata</code> memory is: </p><div class="fragment"><div class="line">&lt;type&gt; idata &lt;identifier&gt; [= &lt;value&gt;];</div></div><!-- fragment --><p>The additional <code>idata</code> memory is located in the upper half of the address range. The lower half accesses <code>data</code> memory. Any <code>data</code> access to a pointer actually is <code>idata</code> access. This is why SFRs cannot be accessed with pointers. They are masked by <code>idata</code> memory.</p>
<p>The slowest kind of memory used by this library is the <code>xdata</code> memory. The <code>xdata</code> memory makes 3kb of additional memory available and the libraries place all large data structures in them.</p>
<p>Variables are declared in <code>xdata</code> with the following syntax: </p><div class="fragment"><div class="line">&lt;type&gt; xdata &lt;identifier&gt; [= &lt;value&gt;];</div></div><!-- fragment --><p>The first 256 bytes of <code>xdata</code> memory are also accessible as 8 bit addressed <code>pdata</code>. Using <code>pdata</code> is faster than <code>xdata</code>. The <code>p</code> in <code>pdata</code> stands for paged. Historically the 8052 family of µCs used register <code>P2</code> for paging. The XC878 instead provides an SFR named XADDRH.</p>
<p>However current 8051 C compilers don't support paging. I.e. one would have to ensure that structs and buffers do not cross page borders and update <code>XADDRH</code> manually. So instead of making the code more complicated and messing with the linkers <code>XADDRH</code> is fixed to the first <code>xdata</code> page and <code>pdata</code> is simply used as an additional 256 bytes of relatively fast memory.</p>
<p>There also is a 128 bits wide memory range of <code>bit</code> variables, which is used by single bit variables of the type <code>bool</code>.</p>
<p>In contrast to the small amount of available RAM, 64k of ROM are available to hold executable code. Thus a program well designed to the XC878 is one that produces a lot of static code to reduce the required amount of runtime memory use.</p>
<p>Code resides in its own address range, the <code>code</code> block. The µC can be run from code residing in <code>xdata</code> as well, to bootstrap the µC. Constants can also be placed in the <code>code</code> block.</p>
<h2><a class="anchor" id="platform_memory_overlaying"></a>
Overlaying</h2>
<p>In order to mitigate the memory limitations of the platform the C51 and SDCC compilers perform an optimisation called overlaying.</p>
<p>The compilers build a call graph, much like the one in the documentation of <a class="el" href="main_8c.html#a6288eba0f8e8ad3ab1544ad731eb7667" title="Call init functions and invoke the run routine. ">main()</a>. The call graph is a directed graph and functions (i.e. their local variables and parameters) may occupy the same space in memory, provided they cannot reach each other in the graph.</p>
<p>E.g. <a class="el" href="main_8c.html#a6288eba0f8e8ad3ab1544ad731eb7667" title="Call init functions and invoke the run routine. ">main()</a> can reach both <a class="el" href="main_8c.html#a2858154e2009b0e6e616f313177762bc" title="Initialize ports, timers and ISRs. ">init()</a> and <a class="el" href="main_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="The main test code body. ">run()</a>, thus <a class="el" href="main_8c.html#a6288eba0f8e8ad3ab1544ad731eb7667" title="Call init functions and invoke the run routine. ">main()</a> may not occupy the same memory as <a class="el" href="main_8c.html#a2858154e2009b0e6e616f313177762bc" title="Initialize ports, timers and ISRs. ">init()</a> and <a class="el" href="main_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="The main test code body. ">run()</a>. However <a class="el" href="main_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="The main test code body. ">run()</a> and <a class="el" href="main_8c.html#a2858154e2009b0e6e616f313177762bc" title="Initialize ports, timers and ISRs. ">init()</a> cannot reach each other, so they may store their data in the same memory.</p>
<p>This reduces the use of the stack, which is expensive in terms of runtime (this statement is not generally true, it just applies to the 8051 family of µCs).</p>
<p>Functions may not be called more than once at a time. I.e. they may not be recursive or called from regular code and interrupts both. Both compilers provide a <code>reentrant</code> keyword to make functions operate on the stack. Its use should be avoided if possible.</p>
<p>Both C51 and SDCC do not track function pointers. Thus creating a function pointer results in a false call in the call tree. A call through a function pointer is not added to the call tree.</p>
<p>The C51 tool chain offers <a class="el" href="toolchain.html#toolchain_lx51_misc">call tree manipulations</a> and SDCC provides the <a class="el" href="sdcc.html#sdcc_interrupts">nooverlay pragma</a> to mitigate this.</p>
<p>The section about <a class="el" href="memory.html#memory_overlay">Implications of Overlaying</a> lists best practices to optimize code for overlaying.</p>
<h1><a class="anchor" id="platform_pointers"></a>
Pointers</h1>
<p>Due to the existence of different kinds of memory, pointers come in two variations, generic pointers and memory-specific pointers. Generic pointers take 3 bytes of memory and are by far the slowest to process. Memory-specific pointers take 1 byte for <code>data</code>, <code>idata</code> or <code>pdata</code> and 2 bytes for <code>xdata</code> or <code>code</code>. They are also faster to process.</p>
<p>Note that the <code>data</code> keyword needs to be explicitely specified for <code>data</code> pointers. Pointers declared without explicit mention of the memory type always result in generic pointers.</p>
<p>Pointers can be stored in different kinds of memory than the memory they point to: </p><div class="fragment"><div class="line">&lt;type&gt; &lt;ptr_target_mem&gt; * &lt;ptr_mem&gt; &lt;identifier&gt;;</div></div><!-- fragment --><p>The following example creates an <code>idata</code> pointer to a struct in <code>xdata</code> memory: </p><div class="fragment"><div class="line">struct foo xdata * idata p_foo;</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Jan 20 2017 00:01:35 for hsk-libs-user by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.12
</small></address>
</body>
</html>
